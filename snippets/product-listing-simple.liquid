{%- liquid

  case settings.product_image_size
    when 'natural'
      assign aspect_ratio = 'natural'
    when 'square'
      assign aspect_ratio = 'square'
    when 'landscape'
      assign aspect_ratio = 'landscape'
    when 'portrait'
      assign aspect_ratio = 'portrait'
  endcase

-%}

<div class="prod-container">
   <div class="prod-image image_{{ aspect_ratio }} js-product-image">
     <a href="{{ product.url | within: collection }}" title="{{ product.title | escape }}">
       <div class="reveal">

        {%- if product.media.size < 1 -%}

          <div class="box-ratio" style="padding-bottom: 100%;">
            {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
            {{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg' }}
          </div>

        {%- else -%}

            {%
              render 'basic-responsive-image',
                type: product.featured_media,
                width: 300
            %}

        {%- endif -%}
       </div>
     </a>
   </div>
</div>

<div class="product-info">
  <a href="{{ product.url | within: collection }}">
    {% if settings.vendor %}
      <p class="product__vendor">{{ product.vendor }}</p>
    {% endif %}
    <h3>{{ product.title }}</h3>
  </a>
  {%- if settings.show_rating and product.metafields.reviews.rating.value != blank -%}
    <div class="product__section--rating-wrapper">
      {% liquid
        assign rating_decimal = 0
        assign decimal = product.metafields.reviews.rating.value.rating | modulo: 1
        if decimal >= 0.3 and decimal <= 0.7
          assign rating_decimal = 0.5
        elsif decimal > 0.7
          assign rating_decimal = 1
        endif
      %}
      <div class="product__section-rating" role="img" aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: product.metafields.reviews.rating.value, rating_max: product.metafields.reviews.rating.value.scale_max }}">
        <span aria-hidden="true" class="product__section-rating-star color-icon" style="--rating: {{ product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"></span>
      </div>
      <p class="product__section-rating-text caption">
        <span aria-hidden="true">{{ product.metafields.reviews.rating.value }} / {{ product.metafields.reviews.rating.value.scale_max }}</span>
      </p>
      <p class="product__section-rating-count caption">
        <span aria-hidden="true">({{ product.metafields.reviews.rating_count }})</span>
        <span class="visually-hidden">{{ product.metafields.reviews.rating_count }} {{ "accessibility.total_reviews" | t }}</span>
      </p>
    </div>
  {%- endif -%}
  {% render 'product-price-listing', product: product %}
  {% if show_quickadd and product.available %}
    {% render 'product-grid-add'
      product: product,
      color_swatch_style: settings.color_swatch_style,
      show_quickview: show_quickview,
      show_sizes: false,
      show_swatches: false %}
  {% endif %}
  {% if show_quickview %}
    {% if product.available %}
      <a href="{{ product.url }}" class="button link--to_product">
        {{ 'products.product.details' | t }}
      </a>
    {% else %}
      <span class="button link--to_product">
        {{ 'products.product.sold_out' | t }}
      </span>
    {% endif %}
  {% endif %}
</div>